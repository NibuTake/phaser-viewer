# Auto-Play Exploration Feature

## 概要
Phaserゲームシーンの自動探索機能。インタラクティブ要素を検出し、自動的にクリックして状態遷移を網羅する。

## 基本コンセプト

### 状態フィンガープリント
- クリック可能要素の組み合わせをユニークIDとして記憶
- 状態変化の検出：IDが変わった時点を画面遷移として認識
- 各状態を有向グラフのノードとして記録

### 状態の識別要素
```javascript
{
  interactiveCount: number,        // インタラクティブ要素数
  visibleTexts: string[],          // 表示テキスト配列
  sceneKey: string,                // シーンキー
  elementPositions: string,        // 要素位置のハッシュ
  customProperties: object         // ゲーム固有の状態
}
```

## 探索戦略

### 1. 優先度付き探索
- **新規要素優先**: 未クリックの要素を優先的に選択
- **境界値探索**: 画面端や特定エリアの要素を重点的に探索
- **深さ制限付きBFS**: 浅い階層を網羅してから深く探索
- **ヒートマップ記録**: クリック頻度の低いエリアを優先

### 2. スマート状態管理
- 訪問済み状態の記録
- バックトラック機能（行き止まりから前の状態に戻る）
- コンボパターンの記憶（特定の操作順序で新状態に到達）

### 3. 準ランダム探索
- 完全ランダムではなく、未探索パスを優先
- 一定回数試行後にランダム要素を追加
- 探索の停滞を防ぐためのリセット機能

## カバレッジ指標

### 測定項目
- **状態カバレッジ**: 発見した状態数 / 推定総状態数
- **遷移カバレッジ**: ユニークな遷移パス数
- **要素カバレッジ**: 各インタラクティブ要素のクリック回数
- **深度カバレッジ**: 初期状態からの最大到達距離

### レポート機能
- 状態遷移グラフの可視化
- 未到達エリアのハイライト
- 探索効率の統計情報

## 技術的実装ポイント

### Phaser統合
```javascript
// インタラクティブ要素の取得
scene.input.manager.getTopOnly()
scene.children.list.filter(obj => obj.input?.enabled)

// クリック可能判定
gameObject.input.enabled && gameObject.visible

// イベント監視
scene.events.on('statechange', handleStateChange)
```

### 状態検出の最適化
- カスタムイベントで状態変化を通知
- Phaser.DataManagerを活用した状態管理
- シーン遷移の自動検出

## 実装フェーズ

### Phase 1: 基本機能
- インタラクティブ要素の検出
- 状態IDの生成と記録
- シンプルな優先度付き探索

### Phase 2: 高度な探索
- グラフベースの状態管理
- バックトラック機能
- カバレッジレポート

### Phase 3: 最適化
- 機械学習による探索パターン学習
- ゲーム固有のカスタマイズ
- CI/CD統合

## ユースケース

### 適用例
- ゲームの自動テスト
- チュートリアルの完全性検証
- アクセシビリティの問題検出
- デッドエンドの発見

### 制限事項
- タイミング依存の要素には限界
- 複雑な組み合わせ操作の検出困難
- パフォーマンスへの影響考慮必要